// LCG parameters
let var seed = 1;

// Function to generate a random integer in the range [min, max]
fun rand_int(min, max) {
    seed = (1103515245 * seed + 12345) & 0x7FFFFFFF;   // keep only 31 bits

    // Don't use the low bits
    let range = max - min + 1;
    return min + (((seed >> 8) * range) >> 23);
}

class Foo
{
    init(s, v)
    {
        s.v = v;
        s.x = 1;
        s.y = 2;
        s.z = 3;
    }
}

$vm_shrink_heap(256_000);

for (let var i = 0; i < 4_000_000; ++i)
{
    let r = rand_int(1, 5);

    if (r == 1) {
        let o = Foo(r);
    } else if (r == 2) {
        let s = "string_" + r.to_s() + r.to_f().to_s();
    } else if (r == 3) {
        let a = [i, r, 0, 0, 0, 9, 1, 2];
    } else if (r == 4) {
        let toks = "foo bar bif".split(" ");
        assert(toks.len == 3);
        assert(toks[2] == "bif");
    } else {
        let ba = ByteArray.with_size(rand_int(0, 9));
    }

    // TODO: closures

    // TODO: dicts
}

$println("done");
